# RAG Server Configuration
# Configuration for the RAG pipeline, admin UI, and WhatsApp bot

# API Keys (set these as environment variables for security)
api_keys:
  groq_api_key: ${GROQ_API_KEY}  # For LLM and STT
  twilio_account_sid: ${TWILIO_ACCOUNT_SID}  # Twilio Account SID
  twilio_auth_token: ${TWILIO_AUTH_TOKEN}  # Twilio Auth Token

# LLM Configuration
llm:
  provider: "groq"  # groq, openai, azure, ollama
  model: "llama-3.1-8b-instant"  # Free tier model on Groq
  temperature: 0.7
  max_tokens: 1024
  
# Embedding Configuration  
embedding:
  provider: "sentence_transformers"  # Local embedding model
  model: "all-MiniLM-L6-v2"
  batch_size: 32

# Reranking Configuration
reranking:
  enabled: true
  provider: "llm"  # Use LLM for reranking to keep it free
  top_k: 5

# Vector Store Configuration
vectorstore:
  provider: "chroma"  # Local vector database
  persist_directory: "./data/chroma_db"
  collection_name: "rag_documents"

# Document Store Configuration
docstore:
  provider: "simple_file"
  storage_path: "./data/documents"

# File Upload Configuration
upload:
  max_file_size_mb: 50
  allowed_extensions: [".pdf", ".txt", ".docx", ".md", ".html", ".xlsx"]
  upload_directory: "./uploads"

# Processing Configuration
processing:
  chunk_size: 1000
  chunk_overlap: 200
  max_chunks_per_doc: 100

# STT Configuration (Speech-to-Text)
stt:
  provider: "groq"  # Using Groq's Whisper API
  model: "whisper-large-v3"
  supported_languages:
    - "hi"  # Hindi
    - "bn"  # Bengali
    - "ta"  # Tamil
    - "gu"  # Gujarati
    - "en"  # English

# TTS Configuration (Text-to-Speech)
tts:
  provider: "edge_tts"  # Free Edge TTS
  supported_languages:
    hi: "hi-IN-SwaraNeural"     # Hindi
    bn: "bn-IN-TanishaaNeural"  # Bengali
    ta: "ta-IN-PallaviNeural"   # Tamil
    gu: "gu-IN-DhwaniNeural"    # Gujarati
    en: "en-IN-NeerjaNeural"    # English (Indian accent)

# Twilio WhatsApp Bot Configuration
twilio_whatsapp:
  webhook_url: "/webhook"
  sandbox_number: "+14155238886"  # Twilio WhatsApp Sandbox
  account_sid: ${TWILIO_ACCOUNT_SID}
  auth_token: ${TWILIO_AUTH_TOKEN}
  
# Server Configuration
server:
  host: "0.0.0.0"
  port: 8000
  reload: false
  workers: 1

# Admin UI Configuration
admin_ui:
  title: "RAG Pipeline Admin"
  theme: "soft"
  auth_required: false  # Set to true for production
  
# Logging Configuration
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file: "./logs/rag_server.log"

# Data Directories
directories:
  data: "./data"
  uploads: "./uploads"
  logs: "./logs"
  cache: "./cache"

# Gemini Live API Configuration (Real-time Voice Conversations)
# IMPORTANT: Gemini Live Native Audio is ONLY available in US/Europe regions!
# Supported: us-central1, us-east1, us-east4, us-west1, europe-west1, etc.
# NOT supported: asia-south1, asia-southeast1, or any Asia-Pacific region
gemini_live:
  enabled: true  # Enabled for voice AI
  project_id: ${GOOGLE_CLOUD_PROJECT}
  location: ${VERTEX_AI_LOCATION}  # MUST be us-central1 or other US/EU region!
  model: "gemini-live-2.5-flash-native-audio"  # GA model (Dec 2024)

  # Voice settings
  default_voice: "Aoede"  # Warm, empathetic voice for healthcare

  # Language support (Indian languages)
  default_language: "en-IN"
  supported_languages:
    - code: "en-IN"
      name: "English (India)"
    - code: "hi-IN"
      name: "Hindi"
    - code: "mr-IN"
      name: "Marathi"
    - code: "ta-IN"
      name: "Tamil"

  # Session settings
  session_timeout_minutes: 14  # Max 15 for Gemini
  max_sessions_per_user: 1

  # Audio settings
  input_sample_rate: 16000   # 16kHz for input
  output_sample_rate: 24000  # 24kHz for output
  chunk_size: 4096

  # RAG integration
  rag_context_enabled: true
  rag_top_k: 3

  # Fallback to existing STT+LLM+TTS pipeline on error
  fallback_enabled: true

  # Transcription capture
  transcription_enabled: true

# Bolna.ai Voice AI Configuration (Primary for Phone Calls)
bolna:
  enabled: true  # Set to true when Bolna is configured
  api_key: ${BOLNA_API_KEY}
  agent_id: ${BOLNA_AGENT_ID}

  # Agent settings
  agent_name: "Palli Sahayak"
  agent_type: "free_flowing"

  # ASR (Speech-to-Text) - Deepgram
  transcriber:
    provider: "deepgram"
    model: "nova-2"
    stream: true

  # LLM - OpenAI
  llm:
    provider: "openai"
    model: "gpt-4o-mini"
    temperature: 0.3
    max_tokens: 500

  # TTS (Text-to-Speech) - ElevenLabs
  synthesizer:
    provider: "elevenlabs"
    model: "eleven_multilingual_v2"
    voice: "Rachel"
    stream: true

  # Language support
  default_language: "hi"
  supported_languages:
    hi:
      name: "Hindi"
      welcome_message: "नमस्ते! मैं पल्ली सहायक हूं, आपका पैलिएटिव केयर सहायक। आज मैं आपकी कैसे मदद कर सकती हूं?"
    en:
      name: "English"
      welcome_message: "Hello! I am Palli Sahayak, your palliative care assistant. How can I help you today?"
    mr:
      name: "Marathi"
      welcome_message: "नमस्कार! मी पल्ली सहायक आहे, तुमचा पॅलिएटिव केअर सहाय्यक."
    ta:
      name: "Tamil"
      welcome_message: "வணக்கம்! நான் பல்லி சகாயக், உங்கள் நோய்த்தடுப்பு பராமரிப்பு உதவியாளர்."

  # Webhook configuration
  webhook:
    enabled: true
    secret: ${BOLNA_WEBHOOK_SECRET}
    events:
      - "call_started"
      - "call_ended"
      - "extraction_completed"
      - "transcription"

  # Custom function for RAG integration
  rag_function:
    name: "query_rag_knowledge_base"
    endpoint: "/api/bolna/query"
    method: "POST"

  # Telephony settings
  telephony:
    provider: "twilio"  # twilio, plivo, or exotel
    phone_number: ${BOLNA_PHONE_NUMBER}

# Voice Router Configuration
voice_router:
  # Provider priority
  preferred_provider: "bolna"  # bolna, gemini_live, or fallback_pipeline

  # Phone call routing
  phone_primary: "bolna"
  phone_fallback: "gemini_live"

  # Web voice routing
  web_primary: "gemini_live"
  web_fallback: "bolna"

  # Ultimate fallback (always available)
  ultimate_fallback: "stt_rag_tts"  # STT → RAG → LLM → TTS pipeline

# Knowledge Graph Configuration (Neo4j)
knowledge_graph:
  enabled: true
  uri: ${NEO4J_URI}
  username: ${NEO4J_USER}
  password: ${NEO4J_PASSWORD}
  database: "neo4j"

  # Entity extraction
  entity_extraction:
    use_llm: true  # Use LLM for better extraction
    use_patterns: true  # Also use regex patterns

  # Cypher generation
  cypher_generation:
    use_llm: true  # Generate Cypher with LLM
    max_results: 100

  # Node types for palliative care
  node_types:
    - Symptom
    - Medication
    - Condition
    - Treatment
    - SideEffect
    - BodyPart

  # Relationship types
  relationship_types:
    - TREATS
    - CAUSES
    - SIDE_EFFECT_OF
    - MANAGES
    - ALLEVIATES
    - AFFECTS
    - CONTRAINDICATES

  # Visualization
  visualization:
    layout: "cose"  # Force-directed layout
    max_nodes: 100